<!DOCTYPE html>
<html>
<head>
    <title>Search test page</title>

    <style>
        body {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 10px;
        }

        .box {
            min-width: 150px;
            min-height: 150px;
        }

        #search {
            font-size: 20px;
        }
    </style>
</head>

<body>

<div class='box'>
    <input type='search' disabled="disabled" placeholder="Loadingâ€¦" id='search' />
    <ul id='results'></ul>
</div>

<script src='https://unpkg.com/lunr/lunr.js'></script>
<script>
(function() {
    const input = document.querySelector('#search');
    const output = document.querySelector('#results');

    let searchIndex;
    let searchData;

    fetch('./static/searchIndex.json')
        .then(response => response.json())
        .then(data => {
            searchIndex = lunr.Index.load(data);

            input.removeAttribute('disabled');
            input.setAttribute('placeholder', 'domain or company name');
        });

    fetch('./static/searchData.json')
        .then(response => response.json())
        .then(data => searchData = data);

    input.addEventListener('change', () => {
        const results = searchIndex.search(input.value);

        output.innerHTML = '';
        const tree = document.createDocumentFragment();

        // don't show more than 10 results
        results.length = 10;

        results.forEach(result => {
            const li = document.createElement('li');
            const entry = searchData[result.ref];
            li.innerText = `${entry.name} (${entry.type})`;

            tree.appendChild(li);
        });

        output.appendChild(tree);
    });
})();
</script>

</body>

</html>
